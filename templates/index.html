<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CertifyFast - Bulk Certificate Generator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & TOKENS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --ink:#e8e4df;
  --ink2:#9a9590;
  --ink3:#5c5652;
  --bg:#141210;
  --card:#1c1a18;
  --card2:#242220;
  --border:#2e2c29;
  --gold:#c9a84c;
  --gold-dim:rgba(201,168,76,.15);
  --green:#5ecc8a;
  --red:#d95a5a;
  --blue:#5a9cd9;
  --r:8px;
}
html{scroll-behavior:smooth}
body{
  font-family:'Inter',system-ui,sans-serif;
  background:var(--bg);
  color:var(--ink);
  min-height:100vh;
  line-height:1.6;
  -webkit-font-smoothing:antialiased;
  overflow-x:hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BACKGROUND TEXTURE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
body::before{
  content:'';
  position:fixed;inset:0;
  background:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.035'/%3E%3C/svg%3E");
  pointer-events:none;z-index:0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wrap{
  position:relative;z-index:1;
  max-width:800px;
  margin:0 auto;
  padding:56px 24px 100px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header{text-align:center;margin-bottom:52px}
.badge{
  display:inline-flex;align-items:center;gap:7px;
  font-size:10.5px;font-weight:600;letter-spacing:.12em;text-transform:uppercase;
  color:var(--gold);
  border:1px solid rgba(201,168,76,.3);
  padding:5px 14px;border-radius:20px;
  margin-bottom:22px;
}
.badge .live{
  width:6px;height:6px;border-radius:50%;
  background:var(--green);
  animation:blink 2.2s ease infinite;
}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

header h1{
  font-family:'Cormorant Garamond',Georgia,serif;
  font-size:clamp(30px,5.5vw,42px);
  font-weight:600;
  color:var(--ink);
  letter-spacing:-.015em;
  margin-bottom:10px;
  line-height:1.2;
}
header p{
  font-size:14px;color:var(--ink2);
  max-width:520px;margin:0 auto 16px;
  font-weight:300;
}
header p code{
  background:var(--gold-dim);color:var(--gold);
  padding:2px 7px;border-radius:4px;
  font-size:13px;font-family:'SF Mono','Fira Code',monospace;
}

/* INFO BOX */
.info-box{
  background:rgba(90,156,217,.1);
  border:1px solid rgba(90,156,217,.3);
  border-radius:var(--r);
  padding:14px 18px;
  margin:20px auto;
  max-width:600px;
  font-size:12.5px;
  color:var(--ink2);
  line-height:1.7;
}
.info-box strong{color:var(--blue);font-weight:600}
.info-box ul{margin:8px 0 0 20px}
.info-box li{margin-bottom:4px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STEP BAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.steps{
  display:flex;align-items:center;justify-content:center;
  gap:0;margin-bottom:40px;
}
.step{display:flex;align-items:center;gap:9px}
.step__n{
  width:28px;height:28px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:12px;font-weight:600;
  background:var(--card2);border:1.5px solid var(--border);
  color:var(--ink3);
  transition:all .3s;
}
.step.active .step__n{border-color:var(--gold);background:var(--gold);color:#141210}
.step.done   .step__n{border-color:var(--green);background:var(--green);color:#141210}
.step__label{font-size:11.5px;color:var(--ink3);font-weight:500;white-space:nowrap;transition:color .3s}
.step.active .step__label{color:var(--gold)}
.step.done   .step__label{color:var(--green)}
.step__line{width:48px;height:1.5px;background:var(--border);border-radius:1px;transition:background .3s}
.step__line.done{background:var(--green)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--r);
  padding:26px 28px;
  margin-bottom:16px;
  transition:border-color .25s;
}
.card:hover{border-color:rgba(201,168,76,.35)}
.card__head{
  font-size:11px;font-weight:600;
  color:var(--ink2);text-transform:uppercase;letter-spacing:.1em;
  margin-bottom:18px;
  display:flex;align-items:center;gap:8px;
}
.card__head .ico{font-style:normal;font-size:15px}

/* Tooltip */
.tooltip{
  position:relative;
  display:inline-block;
  cursor:help;
  margin-left:4px;
}
.tooltip-icon{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:16px;
  height:16px;
  border-radius:50%;
  background:rgba(201,168,76,.2);
  color:var(--gold);
  font-size:11px;
  font-weight:700;
  border:1px solid rgba(201,168,76,.3);
}
.tooltip-text{
  visibility:hidden;
  opacity:0;
  position:absolute;
  z-index:100;
  background:var(--card);
  border:1px solid var(--border);
  color:var(--ink);
  padding:12px 14px;
  border-radius:6px;
  font-size:12px;
  width:280px;
  bottom:125%;
  left:50%;
  transform:translateX(-50%);
  transition:opacity .25s,visibility .25s;
  box-shadow:0 4px 20px rgba(0,0,0,.4);
  line-height:1.5;
}
.tooltip-text::after{
  content:'';
  position:absolute;
  top:100%;
  left:50%;
  margin-left:-5px;
  border-width:5px;
  border-style:solid;
  border-color:var(--border) transparent transparent transparent;
}
.tooltip:hover .tooltip-text{
  visibility:visible;
  opacity:1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DROP ZONES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.drops{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:22px}
@media(max-width:560px){.drops{grid-template-columns:1fr}}

.drop{
  border:1.5px dashed var(--border);
  border-radius:var(--r);
  padding:30px 14px 26px;
  text-align:center;
  cursor:pointer;
  transition:all .25s;
  position:relative;
  background:rgba(255,255,255,.015);
}
.drop:hover,.drop.over{border-color:var(--gold);background:var(--gold-dim)}
.drop.ok{border-color:var(--green);background:rgba(94,204,138,.06)}
.drop input{position:absolute;inset:0;width:100%;height:100%;opacity:0;cursor:pointer}
.drop__ico{font-size:26px;display:block;margin-bottom:8px;transition:all .25s}
.drop__title{font-size:13px;font-weight:600;color:var(--ink);margin-bottom:3px;transition:color .2s;
  display:flex;align-items:center;justify-content:center;gap:4px;}
.drop__sub{font-size:11px;color:var(--ink3)}
.drop__file{font-size:12.5px;font-weight:600;color:var(--green);display:none;word-break:break-all;margin-bottom:2px}
.drop.ok .drop__ico{display:none}
.drop.ok .drop__file{display:block}
.drop.ok .drop__title{color:var(--green);font-size:11px}

/* Signature drop (full width, optional) */
.drop-sig{
  grid-column:1/-1;
  border-style:dashed;
  border-color:rgba(90,156,217,.3);
  background:rgba(90,156,217,.05);
}
.drop-sig:hover{
  border-color:var(--blue);
  background:rgba(90,156,217,.12);
}
.drop-sig.ok{
  border-color:var(--green);
  background:rgba(94,204,138,.06);
}
.drop__optional{
  display:inline-block;
  font-size:9px;
  background:rgba(90,156,217,.2);
  color:var(--blue);
  padding:2px 6px;
  border-radius:3px;
  margin-left:6px;
  text-transform:uppercase;
  letter-spacing:.05em;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OPTIONS SECTION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.options{
  margin-top:20px;
  padding-top:20px;
  border-top:1px solid var(--border);
}
.option-group{
  margin-bottom:16px;
}
.option-label{
  display:block;
  font-size:12px;
  font-weight:600;
  color:var(--ink2);
  margin-bottom:8px;
}
.option-select{
  width:100%;
  background:var(--card2);
  border:1px solid var(--border);
  color:var(--ink);
  padding:10px 12px;
  border-radius:var(--r);
  font-family:inherit;
  font-size:13px;
  cursor:pointer;
  transition:border-color .2s;
}
.option-select:hover{border-color:var(--gold)}
.option-select:focus{outline:none;border-color:var(--gold)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:7px;
  font-family:inherit;font-size:13.5px;font-weight:600;
  padding:11px 28px;border-radius:var(--r);
  border:none;cursor:pointer;
  transition:all .2s;white-space:nowrap;
}
.btn-gold{
  background:var(--gold);color:#141210;
  box-shadow:0 2px 16px rgba(201,168,76,.25);
}
.btn-gold:hover{background:#d4b25a;box-shadow:0 4px 24px rgba(201,168,76,.35);transform:translateY(-1px)}
.btn-gold:active{transform:translateY(0)}
.btn-gold:disabled{opacity:.35;cursor:not-allowed;transform:none;box-shadow:none}

.btn-outline{
  background:transparent;color:var(--ink2);
  border:1px solid var(--border);font-size:11.5px;padding:6px 16px;
}
.btn-outline:hover{border-color:var(--ink2);color:var(--ink)}

.row-center{display:flex;justify-content:center}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANALYSIS PANEL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.panel{display:none}
.panel.show{display:block;animation:slide .35s ease}
@keyframes slide{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* stats */
.stats{display:flex;gap:10px;margin-bottom:16px}
.stat{
  flex:1;background:var(--card2);border:1px solid var(--border);
  border-radius:var(--r);padding:14px 12px;text-align:center;
}
.stat__n{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:700;color:var(--ink)}
.stat__n.gold{color:var(--gold)}
.stat__n.green{color:var(--green)}
.stat__n.amber{color:#e8a84c}
.stat__l{font-size:9.5px;color:var(--ink3);text-transform:uppercase;letter-spacing:.08em;margin-top:2px}

/* mapping list */
.map-list{list-style:none}
.map-list li{
  display:flex;align-items:center;gap:10px;
  padding:9px 0;border-bottom:1px solid var(--border);
  font-size:13px;
}
.map-list li:last-child{border-bottom:none}
.map-list .ph{
  font-family:'SF Mono','Fira Code',monospace;
  font-size:11px;background:var(--gold-dim);color:var(--gold);
  padding:3px 8px;border-radius:4px;white-space:nowrap;
}
.map-list .arrow{color:var(--ink3);font-size:13px}
.map-list .col{color:var(--ink2);font-size:12.5px}
.map-list .col.missing{color:var(--ink3);font-style:italic}
.map-list .badge-ok,.map-list .badge-warn{
  margin-left:auto;font-size:10px;font-weight:600;
  padding:3px 8px;border-radius:4px;
}
.map-list .badge-ok{background:rgba(94,204,138,.15);color:var(--green)}
.map-list .badge-warn{background:rgba(232,168,76,.15);color:#e8a84c}

/* table */
.tbl-wrap{overflow-x:auto;margin-bottom:8px}
table{width:100%;border-collapse:collapse;font-size:12px}
th{background:var(--card2);color:var(--ink2);text-align:left;padding:8px 10px;
   font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:.05em}
td{padding:8px 10px;border-bottom:1px solid var(--border)}
tr:last-child td{border-bottom:none}
.tbl-note{font-size:11px;color:var(--ink3);font-style:italic}

/* generate section */
.gen-section{text-align:center}
.gen-section p{font-size:13px;color:var(--ink2);margin-bottom:18px}
.gen-section .btn{margin-bottom:12px}
.reset-btn{
  background:transparent;border:none;color:var(--ink3);
  font-size:11.5px;cursor:pointer;padding:6px 12px;
  transition:color .2s;text-decoration:underline;
}
.reset-btn:hover{color:var(--ink)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OVERLAY & TOAST
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.85);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  z-index:999;opacity:0;visibility:hidden;transition:all .3s;
}
.overlay.show{opacity:1;visibility:visible}
.spinner{
  width:40px;height:40px;border:3px solid var(--border);
  border-top-color:var(--gold);border-radius:50%;
  animation:spin .8s linear infinite;margin-bottom:16px;
}
@keyframes spin{to{transform:rotate(360deg)}}
.overlay p{color:var(--ink2);font-size:14px}

.toast{
  position:fixed;bottom:24px;left:50%;transform:translateX(-50%);
  background:var(--card);border:1px solid var(--border);
  padding:12px 20px;border-radius:var(--r);font-size:13px;
  box-shadow:0 4px 24px rgba(0,0,0,.5);
  opacity:0;visibility:hidden;transition:all .25s;z-index:1000;
}
.toast.show{opacity:1;visibility:visible}
.toast.ok{border-color:var(--green);color:var(--green)}
.toast.err{border-color:var(--red);color:var(--red)}
</style>
</head>
<body>

<div class="wrap">

<header>
  <div class="badge"><span class="live"></span>CertifyFast</div>
  <h1>Bulk Certificate Generator</h1>
  <p>
    Drop a PDF template containing <code>{{placeholders}}</code> and a CSV or Excel sheet.
    Certificates are generated instantly with correct fonts, sizes and alignment.
  </p>
  
  <div class="info-box">
    <strong>ğŸ’¡ How it works:</strong>
    <ul>
      <li><strong>Placeholders are case-insensitive:</strong> <code>{{Student}}</code>, <code>{{student}}</code>, or <code>{{STUDENT}}</code> all match a column named "Student"</li>
      <li><strong>Column names must match:</strong> If your template has <code>{{name}}</code>, your Excel needs a "Name" or "name" column</li>
      <li><strong>Each certificate gets:</strong> Unique QR code, digital signature, and verification URL</li>
      <li><strong>Optional:</strong> Upload a signature image to add to all certificates</li>
    </ul>
  </div>
</header>

<!-- STEP INDICATOR -->
<div class="steps">
  <div class="step active">
    <div class="step__n">1</div>
    <div class="step__label">Upload</div>
  </div>
  <div class="step__line" id="line1"></div>
  <div class="step">
    <div class="step__n">2</div>
    <div class="step__label">Preview</div>
  </div>
  <div class="step__line" id="line2"></div>
  <div class="step">
    <div class="step__n">3</div>
    <div class="step__label">Generate</div>
  </div>
</div>

<!-- UPLOAD CARD -->
<div class="card">
  <div class="card__head">
    <i class="ico">ğŸ“‚</i> Upload Files
    <div class="tooltip">
      <span class="tooltip-icon">?</span>
      <div class="tooltip-text">
        <strong>Required:</strong> PDF template with {{placeholders}} and data file (CSV/Excel).<br>
        <strong>Optional:</strong> Signature image (PNG/JPG with transparent background recommended).
      </div>
    </div>
  </div>
  
  <div class="drops">
    <div class="drop" id="drop1">
      <input type="file" id="inp1" accept=".pdf">
      <span class="drop__ico">ğŸ“„</span>
      <div class="drop__file" id="name1">â€”</div>
      <div class="drop__title">
        PDF Template
        <div class="tooltip">
          <span class="tooltip-icon">?</span>
          <div class="tooltip-text">
            Your certificate template with placeholders like {{Student}}, {{Course}}, etc. Placeholders are case-insensitive.
          </div>
        </div>
      </div>
      <div class="drop__sub">with {{placeholders}}</div>
    </div>
    
    <div class="drop" id="drop2">
      <input type="file" id="inp2" accept=".csv,.xlsx,.xls">
      <span class="drop__ico">ğŸ“Š</span>
      <div class="drop__file" id="name2">â€”</div>
      <div class="drop__title">
        Data File
        <div class="tooltip">
          <span class="tooltip-icon">?</span>
          <div class="tooltip-text">
            Excel or CSV with columns matching your template placeholders. Column names are case-insensitive.
          </div>
        </div>
      </div>
      <div class="drop__sub">CSV or Excel</div>
    </div>
    
    <div class="drop drop-sig" id="drop3">
      <input type="file" id="inp3" accept=".png,.jpg,.jpeg">
      <span class="drop__ico">âœï¸</span>
      <div class="drop__file" id="name3">â€”</div>
      <div class="drop__title">
        Signature Image
        <span class="drop__optional">Optional</span>
        <div class="tooltip">
          <span class="tooltip-icon">?</span>
          <div class="tooltip-text">
            Upload a signature/stamp image to add to all certificates. PNG with transparent background works best. This is added to the visual certificate, separate from the cryptographic signature used for verification.
          </div>
        </div>
      </div>
      <div class="drop__sub">PNG or JPG (transparent background recommended)</div>
    </div>
  </div>
  
  <div class="options">
    <div class="option-group">
      <label class="option-label">QR Code Position</label>
      <select class="option-select" id="qrPos">
        <option value="bottom-right">Bottom Right</option>
        <option value="bottom-left">Bottom Left</option>
        <option value="top-right">Top Right</option>
        <option value="top-left">Top Left</option>
      </select>
    </div>
    
    <div class="option-group" id="sigPosGroup" style="display:none">
      <label class="option-label">Signature Position</label>
      <select class="option-select" id="sigPos">
        <option value="bottom-center">Bottom Center</option>
        <option value="bottom-left">Bottom Left</option>
        <option value="bottom-right">Bottom Right</option>
      </select>
    </div>
  </div>
  
  <div class="row-center">
    <button class="btn btn-gold" id="analyzeBtn" disabled>Analyze &nbsp;â†’</button>
  </div>
</div>

<!-- ANALYSIS PANEL (hidden until analyzed) -->
<div class="panel" id="panel">

  <!-- stats row -->
  <div class="stats" id="statsRow"></div>

  <!-- mapping card -->
  <div class="card">
    <div class="card__head"><i class="ico">ğŸ”—</i> Placeholder Mapping</div>
    <ul class="map-list" id="mapList"></ul>
  </div>

  <!-- preview card -->
  <div class="card">
    <div class="card__head"><i class="ico">ğŸ‘â€ğŸ—¨</i> Data Preview</div>
    <div class="tbl-wrap" id="tblWrap"></div>
    <p class="tbl-note" id="tblNote"></p>
  </div>

  <!-- generate card -->
  <div class="card">
    <div class="card__head" style="justify-content:center"><i class="ico">âš¡</i> Generate Certificates</div>
    <div class="gen-section">
      <p id="genDesc">Ready to generate.</p>
      <button class="btn btn-gold" id="genBtn">Generate &amp; Download ZIP</button>
      <button class="reset-btn" id="resetBtn">â†© Start over</button>
    </div>
  </div>
</div>

</div><!-- /wrap -->

<!-- OVERLAY -->
<div class="overlay" id="overlay">
  <div class="spinner"></div>
  <p id="overlayMsg">Analyzingâ€¦</p>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
{% raw %}
(function(){
"use strict";

/* â”€â”€ refs â”€â”€ */
const drop1=document.getElementById('drop1'),
      drop2=document.getElementById('drop2'),
      drop3=document.getElementById('drop3'),
      inp1 =document.getElementById('inp1'),
      inp2 =document.getElementById('inp2'),
      inp3 =document.getElementById('inp3'),
      nm1  =document.getElementById('name1'),
      nm2  =document.getElementById('name2'),
      nm3  =document.getElementById('name3'),
      aBtn =document.getElementById('analyzeBtn'),
      panel=document.getElementById('panel'),
      stats=document.getElementById('statsRow'),
      mapL =document.getElementById('mapList'),
      tblW =document.getElementById('tblWrap'),
      tblN =document.getElementById('tblNote'),
      gBtn =document.getElementById('genBtn'),
      rBtn =document.getElementById('resetBtn'),
      ovl  =document.getElementById('overlay'),
      ovlM =document.getElementById('overlayMsg'),
      toast=document.getElementById('toast'),
      qrPos=document.getElementById('qrPos'),
      sigPos=document.getElementById('sigPos'),
      sigPosGroup=document.getElementById('sigPosGroup');

const stepEls=document.querySelectorAll('.step');
const line1=document.getElementById('line1'),
      line2=document.getElementById('line2');

let sid=null, toastT=null;

/* â”€â”€ drag & drop â”€â”€ */
function wire(drop,inp,nameEl,required=true){
  drop.addEventListener('dragover',e=>{e.preventDefault();drop.classList.add('over')});
  drop.addEventListener('dragleave',()=>drop.classList.remove('over'));
  drop.addEventListener('drop',e=>{
    e.preventDefault();drop.classList.remove('over');
    const f=e.dataTransfer.files[0];
    if(f) apply(inp,f,drop,nameEl,required);
  });
  inp.addEventListener('change',()=>{if(inp.files[0]) apply(inp,inp.files[0],drop,nameEl,required)});
}
function apply(inp,file,drop,nameEl,required){
  const ext=file.name.split('.').pop().toLowerCase();
  let ok=[];
  if(inp===inp1) ok=['pdf'];
  else if(inp===inp2) ok=['csv','xlsx','xls'];
  else if(inp===inp3) ok=['png','jpg','jpeg'];
  
  if(!ok.includes(ext)){
    toast_(`.${ok.join('/.').toUpperCase()} only`,'err');
    return;
  }
  const dt=new DataTransfer(); dt.items.add(file); inp.files=dt.files;
  nameEl.textContent=file.name;
  drop.classList.add('ok');
  
  // Show signature position if signature uploaded
  if(inp===inp3){
    sigPosGroup.style.display='block';
  }
  
  checkBtn();
}
function checkBtn(){aBtn.disabled=!(inp1.files[0]&&inp2.files[0])}
wire(drop1,inp1,nm1,true);
wire(drop2,inp2,nm2,true);
wire(drop3,inp3,nm3,false); // signature is optional

/* â”€â”€ step indicator â”€â”€ */
function setStep(n){
  stepEls.forEach((s,i)=>{
    const sn=i+1;
    s.className='step';
    if(sn<n) s.classList.add('done');
    else if(sn===n) s.classList.add('active');
  });
  line1.className='step__line'+(n>1?' done':'');
  line2.className='step__line'+(n>2?' done':'');
}

/* â”€â”€ overlay â”€â”€ */
function showOvl(m){ovlM.textContent=m;ovl.classList.add('show')}
function hideOvl(){ovl.classList.remove('show')}

/* â”€â”€ toast â”€â”€ */
function toast_(msg,type){
  toast.textContent=msg;
  toast.className='toast'+(type==='err'?' err':type==='ok'?' ok':'');
  toast.classList.add('show');
  if(toastT) clearTimeout(toastT);
  toastT=setTimeout(()=>toast.classList.remove('show'),3500);
}

/* â”€â”€ ANALYZE â”€â”€ */
aBtn.addEventListener('click',async()=>{
  showOvl('Analyzing your filesâ€¦');
  aBtn.disabled=true;
  try{
    const fd=new FormData();
    fd.append('template',inp1.files[0]);
    fd.append('data',inp2.files[0]);
    if(inp3.files[0]) fd.append('signature',inp3.files[0]);
    
    const r=await fetch('/api/analyze',{method:'POST',body:fd});
    const j=await r.json();
    if(!r.ok) throw new Error(j.error||'Analysis failed');
    sid=j.session_id;
    render(j);
    setStep(2);
    panel.classList.add('show');
    panel.scrollIntoView({behavior:'smooth',block:'start'});
  }catch(e){toast_(e.message,'err');aBtn.disabled=false}
  finally{hideOvl()}
});

/* â”€â”€ RENDER analysis â”€â”€ */
function render(d){
  const warn=d.unmatched.length;

  // stats
  stats.innerHTML=`
    <div class="stat"><div class="stat__n green">${d.total}</div><div class="stat__l">Certificates</div></div>
    <div class="stat"><div class="stat__n gold">${d.matched.length}</div><div class="stat__l">Matched</div></div>
    <div class="stat"><div class="stat__n ${warn?'amber':'green'}">${warn}</div><div class="stat__l">Unmatched</div></div>`;

  // mapping
  let ml='';
  d.matched.forEach(m=>{
    ml+=`<li><span class="ph">{{${m.placeholder}}}</span><span class="arrow">â†</span>
         <span class="col">${m.column}</span><span class="badge-ok">âœ“ Matched</span></li>`;
  });
  d.unmatched.forEach(k=>{
    ml+=`<li><span class="ph">{{${k}}}</span><span class="arrow">â†</span>
         <span class="col missing">No matching column</span><span class="badge-warn">âš  Missing</span></li>`;
  });
  mapL.innerHTML=ml;

  // table
  if(d.preview.length){
    let t=`<table><thead><tr>${d.columns.map(c=>`<th>${c}</th>`).join('')}</tr></thead><tbody>`;
    d.preview.forEach(row=>{
      t+=`<tr>${d.columns.map(c=>`<td>${row[c]||'â€”'}</td>`).join('')}</tr>`;
    });
    t+='</tbody></table>';
    tblW.innerHTML=t;
    tblN.textContent=`Showing first ${d.preview.length} of ${d.total} rows.`;
  }

  let genMsg = `${d.total} certificate${d.total>1?'s':''} will be generated`;
  if(d.has_signature) genMsg += ' with signature';
  genMsg += ' and downloaded as a ZIP.';
  document.getElementById('genDesc').textContent=genMsg;
  setStep(3);
}

/* â”€â”€ GENERATE â”€â”€ */
gBtn.addEventListener('click',async()=>{
  if(!sid){toast_('Please analyze files first.','err');return}
  showOvl('Generating certificatesâ€¦ This may take a moment.');
  gBtn.disabled=true;
  try{
    const fd=new FormData();
    fd.append('session_id',sid);
    fd.append('qr_position',qrPos.value);
    fd.append('sig_position',sigPos.value);
    
    const r=await fetch('/api/generate',{method:'POST',body:fd});
    if(!r.ok){const j=await r.json();throw new Error(j.error||'Failed')}
    const blob=await r.blob();
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='certificates.zip';
    document.body.appendChild(a); a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(a.href);
    toast_('âœ“ Certificates generated! Download started.','ok');
  }catch(e){toast_(e.message,'err')}
  finally{hideOvl();gBtn.disabled=false}
});

/* â”€â”€ RESET â”€â”€ */
rBtn.addEventListener('click',()=>{
  sid=null;
  inp1.value=''; inp2.value=''; inp3.value='';
  nm1.textContent='â€”'; nm2.textContent='â€”'; nm3.textContent='â€”';
  drop1.classList.remove('ok'); drop2.classList.remove('ok'); drop3.classList.remove('ok');
  sigPosGroup.style.display='none';
  panel.classList.remove('show');
  setStep(1); aBtn.disabled=true;
  window.scrollTo({top:0,behavior:'smooth'});
});

})();
{% endraw %}
</script>
</body>
</html>
